<!DOCTYPE html>
<!-- saved from url=(0059)http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Lab Guide: Vulnerability Risk Management with Elastic</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */

@import url(https://fonts.googleapis.com/css?family=Montserrat|Open+Sans);
@import "asciidoctor.css"; /* Default asciidoc style framework - important */

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */
:root{
--maincolor:#FFFFFF;
--primarycolor:#294172; /* Fedora Dark Blue */
--secondarycolor:#3c6eb4; /* Fedora Blue */
--tertiarycolor:#CCCCCC;
--highlightcolor:#e59728; /* Features Orange */
--sidebarbackground:#CACACA;
--linkcolor:#0D47A1;
--linkcoloralternate:#db3279; /* Friends Magneta */
--white:#FFFFFF;
--black:#000000;
}

/* Text styles */

body{font-family: "Open Sans",sans-serif;background-color: var(--maincolor);color:var(--black);}

h1{color:var(--primarycolor) !important;font-family:"Montserrat",sans-serif;}
h2,h3,h4,h5,h6{color:var(--secondarycolor) !important;font-family:"Montserrat",sans-serif;}
.title{color:var(--black) !important;font-family:"Open Sans",sans-serif;font-style: normal; font-weight: normal;}
a{text-decoration: none;}
p{font-family: "Open Sans",sans-serif ! important}
#toc.toc2 a:link{color:var(--linkcolor);}
blockquote{color:var(--linkcoloralternate) !important}
.quoteblock blockquote:before{color:var(--linkcoloralternate)}
code{color:var(--white)}


/* Table styles */
th{background-color: var(--maincolor);color:var(--black) !important;}
td{background-color: var(--maincolor);color: var(--black) !important}


#toc.toc2{background-color:var(--sidebarbackground);}
#toctitle{color:var(--white);}

/* Responsiveness fixes */
video {
  max-width: 100%;
}

@media all and (max-width: 600px) {
table {
  width: 55vw!important;
  font-size: 3vw;
}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style type="text/css">:root topadblock, :root input[onclick^="window.open('http://www.FriendlyDuck.com/"], :root img[alt^="Fuckbook"], :root iframe[src^="http://static.mozo.com.au/strips/"], :root iframe[src^="http://cdn2.adexprt.com/"], :root iframe[id^="google_ads_iframe"], :root header#hdr + #main > div[data-hveid], :root div[id^="zergnet-widget"], :root div[id^="mainads"], :root div[id^="dmRosAdWrapper"], :root a[href^="http://at.atwola.com/"], :root a[onmousedown^="this.href='https://paid.outbrain.com/network/redir?"][target="_blank"] + .ob_source, :root div[id^="div-ads-"], :root a[data-obtrack^="http://paid.outbrain.com/network/redir?"], :root a[href^="http://www1.clickdownloader.com/"], :root div[id^="cns_ads_"], :root #\5f _admvnlb_modal_container, :root div[id^="adspot-"], :root a[href^="https://trust.zone/go/r.php?RID="], :root div[id^="tms-ad-dfp-"], :root input[onclick^="window.open('http://www.friendlyduck.com/"], :root div[id^="ads300_250-widget"], :root div[id^="ads250_250-widget"], :root div[id^="adrotate_widgets-"], :root div[id^="adfox_"], :root div[id^="ad_script_"], :root #content > #right > .dose > .dosesingle, :root div[id^="ad_bigbox_"], :root div[id^="ad-server-"], :root div[id^="acm-ad-tag-"], :root div[id^="ADV-SLOT-"], :root div[data-native_ad], :root a[href^=" http://n47adshostnet.com/"], :root div[data-id^="CarouselPLA-"] > .kzwEHf, :root div[class^="proadszone-"], :root div[class^="pane-google-admanager-"], :root a[href^="http://adultgames.xxx/"], :root a[href^="http://semi-cod.com/clicks/"], :root div[class^="index_displayAd_"], :root a[href^="http://www.affbuzzads.com/affiliate/"], :root div[class^="index_adBeforeContent_"], :root div[class^="index_adAfterContent_"], :root div[class^="block-openx-"], :root div[class^="ads-partner-"], :root div[class^="ad_position_"], :root div[class^="ad_border_"], :root a[href^="http://adprovider.adlure.net/"], :root div[class^="Ad__container"], :root div[id^="div-adtech-ad-"], :root div[class*="_AdInArticle_"], :root div > [class][onclick*=".updateAnalyticsEvents"], :root a[href^="http://internalredirect.site/"], :root bottomadblock, :root a[href^="https://watchmygirlfriend.tv/"], :root a[href^="http://2pxg8bcf.top/"], :root aside[itemtype="https://schema.org/WPAdBlock"], :root a[href^="http://c.actiondesk.com/"], :root aside[id^="div-gpt-ad"], :root div[id^="ad-cid-"], :root a[href^="http://lp.ezdownloadpro.info/"], :root a[href^="http://uploaded.net/ref/"], :root aside[id^="advads_ad_widget-"], :root aside[id^="adrotate_widgets-"], :root a[target="_blank"][href^="http://api.taboola.com/"], :root a[style="display:block;width:300px;min-height:250px"][href^="http://li.cnet.com/click?"], :root a[onmousedown^="this.href='http://paid.outbrain.com/network/redir?"][target="_blank"] + .ob_source, :root a[href^="http://popup.taboola.com/"], :root a[href^="//adbit.co/?a=Advertise&"], :root a[onmousedown^="this.href='/wp-content/embed-ad-content/"], :root div[class^="AdhesionAd_"], :root div[class^="Ad__bigBox"], :root div[role="navigation"] + c-wiz > script + div > .kxhcC, :root a[onclick*="//m.economictimes.com/etmack/click.htm"], :root a[href^="https://www.what-sexdating.com/"], :root a[href^="https://www.travelzoo.com/oascampaignclick/"], :root a[href^="https://www.share-online.biz/affiliate/"], :root a[href^="https://www.securegfm.com/"], :root div[id^="advads_"], :root a[href^="https://www.moscarossa.biz/"], :root a[href^="http://www.usearchmedia.com/signup?"], :root a[onmousedown^="this.href='http://staffpicks.outbrain.com/network/redir?"][target="_blank"] + .ob_source, :root a[href^="https://www.incontri-matura.com/"], :root a[href^="https://www.goldenfrog.com/vyprvpn?offer_id="][href*="&aff_id="], :root .trc_related_container div[data-item-syndicated="true"], :root a[href^="https://www.firstload.com/affiliate/"], :root a[href^="https://www.camyou.com/?cam="][href*="&track="], :root a[href^="https://www.bebi.com"], :root a[href^="https://www.adskeeper.co.uk/"], :root a[href^="http://pan.adraccoon.com?"], :root div[id^="ad-gpt-"], :root a[href^="http://farm.plista.com/pets"], :root a[href^="https://windscribe.com/promo/"], :root a[href^="http://serve.williamhill.com/promoRedirect?"], :root a[href^="https://vodexor.us/"], :root a[href^="https://track.adform.net/"], :root a[href^="https://traffic.bannerator.com/"], :root a[href^="https://tracking.truthfinder.com/?a="], :root a[href^="https://www.adultempire.com/"][href*="?partner_id="], :root a[href^="https://track.healthtrader.com/"], :root a[href^="https://track.clickmoi.xyz/"], :root a[href^="https://track.afftck.com/"], :root a[href^="https://control.trafficfabrik.com/"], :root a[href^="https://track.52zxzh.com/"], :root div[class^="gemini-ad"], :root a[href^="http://pwrads.net/"], :root a[href^="//oardilin.com/"], :root a[href^="http://gca.sh/user/register?ref="], :root a[href^="https://torguard.net/aff.php"], :root a[href^="http://tour.affbuzzads.com/"], :root a[href^="https://tc.tradetracker.net/"], :root a[href^="https://t.mobtya.com/"], :root a[href^="https://t.grtyi.com/"], :root aside[id^="tn_ads_widget-"], :root a[href^="https://syndication.exoclick.com/splash.php?"], :root a[href^="http://click.guamwnvgashbkashawhgkhahshmashcas.pw/"], :root div[id^="YFBMSN"], :root div[id^="ad-div-"], :root a[href^="https://secure.eveonline.com/ft/?aid="], :root a[href^="https://rev.adsession.com/"], :root a[href^="https://retiremely.com/"], :root div[id^="yandex_ad"], :root a[href^="http://y1jxiqds7v.com/"], :root a[href^="https://www.pornhat.com/"][rel="nofollow"], :root AD-SLOT, :root a[href^="http://green.trafficinvest.com/"], :root a[href^="https://pubads.g.doubleclick.net/"], :root a[href^="https://prf.hn/click/"][href*="/adref:"], :root a[href^="https://mk-cdn.net/"], :root div[id^="proadszone-"], :root a[href^="https://mk-ads.com/"], :root a[href^="https://jmp.awempire.com/"], :root a[href^="https://members.linkifier.com/public/affiliateLanding?refCode="], :root a[href^="https://medleyads.com/"], :root div[id^="ads300_100-widget"], :root a[href^="https://click.plista.com/pets"], :root a[href^="https://lingthatsparleso.info/"], :root a[href^="https://laptop-updates.brave.com/download/"], :root a[href*=".approvallamp.club/"], :root a[href^="https://landing1.brazzersnetwork.com"], :root a[href^="https://land.rk.com/landing/"], :root .lads[width="100%"][style="background:#FFF8DD"], :root a[href^="https://land.brazzersnetwork.com/landing/"], :root a[href^="https://incisivetrk.cvtr.io/click?"], :root a[href^="https://iactrivago.ampxdirect.com/"], :root a[href^="https://googleads.g.doubleclick.net/pcs/click"], :root a[href^="http://cdn.adstract.com/"], :root a[href^="https://gogoman.me/"], :root a[href^="https://go.stripchat.com/"][href*="&campaignId="], :root a[href*=".inclk.com/"], :root a[href^="https://go.ad2up.com/"], :root a[href^="https://freeadult.games/"], :root a[href^="//nlkdom.com/"], :root a[onmousedown^="this.href='http://staffpicks.outbrain.com/network/redir?"][target="_blank"], :root a[href^="https://fonts.fontplace9.com/"], :root a[href^="http://clkmon.com/adServe/"], :root a[href^="https://flirtaescopa.com/"], :root a[href^="https://farm.plista.com/pets"], :root a[href^="https://evaporate.pw/"], :root a[href^="http://wxdownloadmanager.com/dl/"], :root div[class^="local-feed-banner-ads"], :root .GFYY1SVE2 > .GFYY1SVD2 > .GFYY1SVG5, :root a[href^="https://djtcollectorclub.org/"][href*="?affiliate_id="], :root a[href^="https://chaturbate.xyz/"], :root a[href^="https://chaturbate.jjgirls.com/"][href*="?tour="], :root a[href^="https://chaturbate.com/in/?tour="], :root a[href^="https://chaturbate.com/affiliates/"], :root a[href^="http://www.1clickdownloader.com/"], :root a[href^="https://www.googleadservices.com/pagead/aclk?"], :root a[href^="https://awentw.com/"], :root a[href^="https://servedbyadbutler.com/"], :root a[href^="http://dethao.com/"], :root a[href^="https://ads.ad4game.com/"], :root a[href^="https://betway.com/"][href*="&a="], :root a[href^="https://affiliates.bet-at-home.com/processing/"], :root a[href*="pussl3.com"], :root a[href^="https://adswick.com/"], :root ADS-RIGHT, :root .GKJYXHBF2 > .GKJYXHBE2 > .GKJYXHBH5, :root a[href^="https://adserver.adreactor.com/"], :root a[href^="https://refpaano.host/"], :root a[href^="http://data.linoleictanzaniatitanic.com/"], :root a[href^="https://adhealers.com/"], :root a[href^="https://adclick.g.doubleclick.net/"], :root a[href^="https://ad.doubleclick.net/"], :root a[href^="http://zevera.com/afi.html"], :root a[href^="http://go.oclaserver.com/"], :root a[href^="https://ad.atdmt.com/"], :root .trc_rbox .syndicatedItem, :root a[href^="https://aaucwbe.com/"], :root a[href^="https://a.adtng.com/"], :root a[href^="http://xtgem.com/click?"], :root a[href^="https://ads.trafficpoizon.com/"], :root a[href^="http://rekoverr.com/"], :root a[href^="https://chaturbate.com/in/?track="], :root a[href^="http://www.zergnet.com/i/"], :root a[href^="http://hyperies.info/"], :root a[href^="http://galleries.pinballpublishernetwork.com/"], :root a[href^="http://www.torntv-downloader.com/"], :root a[href^="http://www.tirerack.com/affiliates/"], :root a[href^="http://www.text-link-ads.com/"], :root a[href^="http://www.friendlyquacks.com/"], :root div[id^="div_openx_ad_"], :root a[href^="http://www.streamate.com/exports/"], :root a[onmousedown^="this.href='https://paid.outbrain.com/network/redir?"][target="_blank"], :root a[href^="http://www.sfippa.com/"], :root a[href^="http://www.xmediaserve.com/"], :root a[href^="http://www.sex.com/videos/?utm_"], :root a[href^="http://paid.outbrain.com/network/redir?"], :root a[href^="http://www.sex.com/?utm_"], :root a[onmousedown^="this.href='http://paid.outbrain.com/network/redir?"][target="_blank"], :root a[href^="http://www.roboform.com/php/land.php"], :root a[href^="http://www.myfreecams.com/?co_id="][href*="&track="], :root div[id^="advads-"], :root a[href^="https://k2s.cc/pr/"], :root a[href^="http://ad.au.doubleclick.net/"], :root a[href^="http://www.ringtonematcher.com/"], :root a[href^="http://secure.signup-page.com/"], :root a[href^="http://www.quick-torrent.com/download.html?aff"], :root a[href^="http://adexprt.me/"], :root a[href^="http://www.pinkvisualgames.com/?revid="], :root a[href^="https://trklvs.com/"], :root a[href^="http://www.paddypower.com/?AFF_ID="], :root div[data-spotim-slot], :root a[href^="http://www.freefilesdownloader.com/"], :root a[href^="http://www.mysuperpharm.com/"], :root .trc_rbox_border_elm .syndicatedItem, :root a[href^="http://www.myfreepaysite.com/sfw_int.php?aid"], :root a[href^="http://www.myfreepaysite.com/sfw.php?aid"], :root .rhsvw[style="background-color:#fff;margin:0 0 14px;padding-bottom:1px;padding-top:1px;"], :root a[href^="http://www.moneyducks.com/"], :root a[href^="http://bcntrack.com/"], :root a[href^="http://www.securegfm.com/"], :root a[href^="http://www.liversely.net/"], :root a[href^="http://www.linkbucks.com/referral/"], :root a[href^="//88d7b6aa44fb8eb.com/"], :root a[href^="http://www.ireel.com/signup?ref"], :root a[href*="=Adtracker"], :root a[href^="http://www.incredimail.com/?id="], :root a[href^="http://www.idownloadplay.com/"], :root a[href^="http://www.hitcpm.com/"], :root a[href^="http://www.greenmangaming.com/?tap_a="], :root a[href^="http://www.gamebookers.com/cgi-bin/intro.cgi?"], :root a[href^="https://www.financeads.net/tc.php?"], :root a[href^="http://www.friendlyduck.com/AF_"], :root a[href*="emprestimo.eu"], :root a[href^="http://www.fpcTraffic2.com/blind/in.cgi?"], :root a[href^="http://www.fonts.com/BannerScript/"], :root a[href^="http://www.fleshlight.com/"], :root a[href^="http://www.flashx.tv/downloadthis"], :root .trc_rbox_div a[target="_blank"][href^="http://tab"], :root a[href^="https://americafirstpolls.com/"], :root a[href^="http://clickserv.sitescout.com/"], :root a[href^="http://www.firstload.de/affiliate/"], :root a[href^="http://www.twinplan.com/AF_"], :root a[href^="http://www.fducks.com/"], :root a[href^="http://marketgid.com"], :root a[href^="http://www.faceporn.net/free?"], :root a[href^="http://www.epicgameads.com/"], :root a[href^="http://www.easydownloadnow.com/"], :root a[href^="http://www.duckssolutions.com/"], :root a[href^="https://go.trkclick2.com/"], :root a[href^="http://www.duckcash.eu/"], :root a[href^="http://www.drowle.com/"], :root a[href^="http://go.seomojo.com/tracking202/"], :root a[href^="http://www.downloadweb.org/"], :root .commercial-unit-mobile-top .jackpot-main-content-container > .UpgKEd + .nZZLFc > .vci, :root a[href^="http://www.installads.net/"], :root div[role="navigation"] + c-wiz > div > .kxhcC, :root a[href^="http://www.download-provider.org/"], :root a[href^="http://www.down1oads.com/"], :root a[href^="https://trafficmedia.center/"], :root a[href^="http://www.dealcent.com/register.php?affid="], :root .rscontainer > .ellip, :root a[href^="http://www.clkads.com/adServe/"], :root a[href^="http://www.clickansave.net/"], :root div[class^="adpubs-"], :root a[href*="deliver.trafficfabrik.com"], :root a[href^="http://www.cash-duck.com/"], :root a[href^="http://www.bitlord.me/share/"], :root a[href^="http://www.bet365.com/"][href*="?affiliate="], :root a[href^="http://www.bet365.com/"][href*="&affiliate="], :root a[href^="http://www.badoink.com/go.php?"], :root #mbEnd[cellspacing="0"][cellpadding="0"], :root div[data-ad-underplayer], :root a[href^="http://www.richducks.com/"], :root a[href^="http://www.babylon.com/welcome/index?affID"], :root a[href^="http://www.sexgangsters.com/?pid="], :root a[href^="http://www.amazon.co.uk/exec/obidos/external-search?"], :root a[href^="https://ads-for-free.com/click.php?"], :root a[href^="http://tracker.mybroadband.co.za/"], :root a[href^="http://www.socialsex.com/"], :root a[href^="https://www.camsoda.com/enter.php?id="], :root a[href^="http://www.afco2go.com/srv.php?"], :root a[href^="http://go.ad2up.com/"], :root a[href^="https://badoinkvr.com/"], :root a[href*="/adServe/banners?"], :root a[href^="http://www.adxpansion.com"], :root a[href^="http://www.ragazzeinvendita.com/?rcid="], :root .plistaList > .itemLinkPET, :root a[href^="http://ads.pheedo.com/"], :root a[href^="http://www.adbrite.com/mb/commerce/purchase_form.php?"], :root a[href^="http://www.TwinPlan.com/AF_"], :root #rhs_block .mod > .gws-local-hotels__booking-module, :root a[href^="http://www.my-dirty-hobby.com/?sub="], :root a[href^="https://porndeals.com/?track="], :root a[href^="http://www.affiliates1128.com/processing/"], :root a[href^="http://c.jumia.io/"], :root a[href^="http://www.1clickmoviedownloader.info/"], :root div[class^="adbanner_"], :root a[href^="http://www.brightwheel.info/"], :root a[href^="http://www.123-reg.co.uk/affiliate2.cgi"], :root div[id^="lazyad-"], :root div[itemtype="http://www.schema.org/WPAdBlock"], :root a[href^="http://wopertific.info/"], :root a[href^="http://bodelen.com/"], :root a[href^="http://wgpartner.com/"], :root a[href^="http://webgirlz.online/landing/"], :root div[id^="ads300_600-widget"], :root div[class^="Ad__adContainer"], :root a[href^="http://web.adblade.com/"], :root div[class^="BlockAdvert-"], :root a[href^="https://go.onclasrv.com/"], :root a[href^="http://wct.link/"], :root a[href^="http://s9kkremkr0.com/"], :root a[href^="https://www.nutaku.net/signup/landing/"], :root a[href^="http://us.marketgid.com"], :root a[href^="http://ul.to/ref/"], :root a[href^="http://trk.mdrtrck.com/"], :root a[href*=".ichlnk.com/"], :root div[id^="div_ad_stack_"], :root a[href^="http://traffic.tc-clicks.com/"], :root div[class^="awpcp-random-ads"], :root a[href^="http://www.graboid.com/affiliates/"], :root a[href^="http://tracking.toroadvertising.com/"], :root a[href^="http://www.liutilities.com/"], :root a[href^="http://www.dl-provider.com/search/"], :root a[href^="http://tracking.deltamediallc.com/"], :root a[href^="http://adultfriendfinder.com/p/register.cgi?pid="], :root a[href^="https://www.popads.net/users/"], :root iframe[src^="http://ad.yieldmanager.com/"], :root a[href^="http://pubads.g.doubleclick.net/"], :root a[href^="https://sexdatingz.live/"], :root a[href^="//bwnjijl7w.com/"], :root a[href^="https://adultfriendfinder.com/go/page/landing"], :root a[href^="http://tracking.crazylead.com/"], :root a[href^="http://track.adform.net/"], :root a[href^="https://iac.ampxdirect.com/"], :root a[href^="http://t.mdn2015x3.com/"], :root a[href^="http://steel.starflavor.bid/"], :root a[href^="http://galleries.securewebsiteaccess.com/"], :root a[href^="http://stateresolver.link/"], :root a[href^="http://sharesuper.info/"], :root a[href^="http://server.cpmstar.com/click.aspx?poolid="], :root a[href^="http://www.downloadthesefiles.com/"], :root a[href^="http://secure.cbdpure.com/aff/"], :root a[href^="http://t.mdn2015x1.com/"], :root a[href^="http://azmobilestore.co/"], :root a[href^="http://s5prou7ulr.com/"], :root a[href*="/cmd.php?ad="], :root a[href^="http://refpaano.host/"], :root #\5f _mom_ad_2, :root a[href^="http://ads.sprintrade.com/"], :root a[href^="http://record.commissionking.com/"], :root div[class*="-storyBodyAd-"], :root a[href^="http://record.betsafe.com/"], :root a[href^="https://keep2share.cc/pr/"], :root a[href^="https://clixtrac.com/"], :root [onclick*="content.ad/"], :root a[href^="http://adlev.neodatagroup.com/"], :root a[href^="http://reallygoodlink.extremefreegames.com/"], :root .ob_container .item-container-obpd, :root a[href^="http://www.adskeeper.co.uk/"], :root a[href^="http://websitedhoome.com/"], :root a[href^="http://see-work.info/"], :root a[href^="http://prousa.work/"], :root a[href^="http://promos.bwin.com/"], :root a[href^="http://prochina.link/"], :root a[href*=".irtyc.com/"], :root a[href^="http://z1.zedo.com/"], :root a[href^="http://pokershibes.com/index.php?ref="], :root #rhs_block .mod > .luhb-div > div[data-async-type="updateHotelBookingModule"], :root a[href^="http://mojofun.info/"], :root a[href^="http://mmo123.co/"], :root a[href^="http://media.paddypower.com/redirect.aspx?"], :root a[href*=".qertewrt.com/"], :root a[href^="//pubads.g.doubleclick.net/"], :root a[href^="http://lp.ncdownloader.com/"], :root #rhs_block .xpdopen > ._OKe > div > .mod > ._yYf, :root a[href^="//ads.ad-center.com/"], :root a[href^="https://track.trkinator.com/"], :root a[data-redirect^="this.href='http://paid.outbrain.com/network/redir?"], :root div[id^="ad-position-"], :root a[href^="http://liversely.com/"], :root a[href^="https://www.arthrozene.com/"][href*="?tid="], :root a[href^="http://feeds1.validclick.com/"], :root a[href^="http://latestdownloads.net/download.php?"], :root a[href^="http://k2s.cc/code/"], :root #topstuff > #tads, :root a[href^="https://atomidownload.com/"], :root a[href*=".bang.com/"][href*="&aff="], :root a[data-widget-outbrain-redirect^="http://paid.outbrain.com/network/redir?"], :root a[href^="http://join3.bannedsextapes.com/track/"], :root a[href^="https://secure.bstlnk.com/"], :root a[href^="http://jobitem.org/"], :root a[href^="https://gamescarousel.com/"], :root a[href^="http://istri.it/?"], :root a[href^="http://www.fbooksluts.com/"], :root a[href^="http://www.cdjapan.co.jp/aff/click.cgi/"], :root a[href^="//api.ad-goi.com/"], :root a[href*="//ridingintractable.com/"], :root a[href^="http://intent.bingads.com/"], :root div[id^="crt-"][style], :root a[href^="http://igromir.info/"], :root a[href^="https://track.themadtrcker.com/"], :root a[href^="http://hyperlinksecure.com/go/"], :root a[href^="http://45eijvhgj2.com/"], :root a[href^="http://hpn.houzz.com/"], :root a[href^="http://searchtabnew.com/"], :root a[href*="?adlivk="][href*="&refer="], :root a[href^="//look.djfiln.com/"], :root a[href^="http://greensmoke.com/"], :root a[href^="https://bnsjb1ab1e.com/"], :root a[href^="http://mo8mwxi1.com/"], :root div[class^="ResponsiveAd-"], :root a[href^="http://install.securewebsiteaccess.com/"], :root a[href^="http://www.revenuehits.com/"], :root div[id^="block-views-topheader-ad-block-"], :root a[href^="https://bs.serving-sys.com"], :root .__y_elastic .__y_item, :root a[href^="http://go.mobisla.com/"], :root a[href^="//srv.buysellads.com/"], :root a[href^="http://g1.v.fwmrm.net/ad/"], :root .widget-pane-section-result[data-result-ad-type], :root a[href^="http://imads.integral-marketing.com/"], :root a[href^="http://freesoftwarelive.com/"], :root a[href^="http://adtrackone.eu/"], :root a[href^="http://finaljuyu.com/"], :root a[href^="https://paid.outbrain.com/network/redir?"], :root a[href^="http://fileupnow.rocks/"], :root a[href^="http://fileloadr.com/"], :root a[href^="https://dltags.com/"], :root a[href^="http://onclickads.net/"], :root a[href^="https://gghf.mobi/"], :root a[href^="http://www.terraclicks.com/"], :root a[href^="http://www.coinducks.com/"], :root a[href^="http://extra.bet365.com/"][href*="?affiliate="], :root a[href^="http://ethfw0370q.com/"], :root [id^="bunyad_ads_"], :root a[href^="http://elitefuckbook.com/"], :root a[href^="https://www.brazzersnetwork.com/landing/"], :root #cnt #center_col > #taw > #tvcap > .c._oc._Lp, :root [href*="//xml.revrtb.com/"], :root a[href^="http://elite-sex-finder.com/?"], :root a[href^="http://eclkmpsa.com/"], :root a[href*="//3wr110.xyz/"], :root a[href^="http://earandmarketing.com/"], :root a[href^="https://www.mypornstarcams.com/landing/click/"], :root a[href*=".intab.fun/"], :root a[href^="http://secure.signup-way.com/"], :root [href^="https://maskip.co/"], :root a[href^="http://getlinksinaseconds.com/"], :root #content > #center > .dose > .dosesingle, :root a[href^="http://campaign.bharatmatrimony.com/track/"], :root a[href^="http://d2.zedo.com/"], :root a[href^="http://keep2share.cc/pr/"], :root a[href^="http://cp.cbbp1.com"], :root a[href^="http://contractallsticker.net/"], :root a[href^="http://codec.codecm.com/"], :root div[id^="google_dfp_"], :root a[href^="//5e1fcb75b6d662d.com/"], :root a[href^="http://googleads.g.doubleclick.net/pcs/click"], :root div[id^="ads120_600-widget"], :root a[href^="https://awejmp.com/"], :root a[href^="http://clk.directrev.com/"], :root a[href^="http://refer.webhostingbuzz.com/"], :root a[href^="http://clicks.guamwnvgashbkashawhgkhahshmashcas.pw/"], :root a[href^="http://www.downloadplayer1.com/"], :root a[href^="http://clicks.binarypromos.com/"], :root div[class^="largeRectangleAd_"], :root a[href^="https://dediseedbox.com/clients/aff.php?"], :root a[href^="http://www.wantstraffic.com/"], :root a[href^="http://databass.info/"], :root a[href^="http://www.urmediazone.com/signup"], :root a[href^="http://click.plista.com/pets"], :root a[href^="https://a.bestcontentpc.top/"], :root a[href^="http://chaturbate.com/affiliates/"], :root a[href^="http://www.firstload.com/affiliate/"], :root a[href^="http://www.friendlyadvertisements.com/"], :root a[href^="//00ae8b5a9c1d597.com/"], :root a[href^="http://cdn3.adbrau.com/"], :root a[href^="http://get.slickvpn.com/"], :root a[href^="http://amzn.to/"] > img[src^="data"], :root a[href^="http://bs.serving-sys.com/"], :root a[href^="http://cpaway.afftrack.com/"], :root a[href^="http://cdn.adsrvmedia.net/"], :root [lazy-ad="top_banner"], :root a[href^="http://360ads.go2cloud.org/"], :root a[href^="http://dftrck.com/"], :root a[href^="http://casino-x.com/?partner"], :root div[data-flt-ve="sponsored_search_ads"], :root a[href^="http://record.sportsbetaffiliates.com.au/"], :root a[href^="http://campeeks.com/"][href*="&utm_"], :root #flowplayer > div[style="position: absolute; width: 300px; height: 275px; left: 222.5px; top: 85px; z-index: 999;"], :root a[href^="http://download-performance.com/"], :root a[href^="http://www.on2url.com/app/adtrack.asp"], :root #\5f _nq__hh[style="display:block!important"], :root a[href^="http://guideways.info/"], :root a[href^="http://campaign.bharatmatrimony.com/cbstrack/"], :root a[href^="http://ads.expekt.com/affiliates/"], :root a[href^="http://callville.xyz/"], :root a[href^="http://xads.zedo.com/"], :root a[href^="http://yads.zedo.com/"], :root a[href^="https://bullads.net/get/"], :root a[href^="http://down1oads.com/"], :root a[href^="http://buysellads.com/"], :root a[href^="https://uncensored.game/"], :root td[valign="top"] > .mainmenu[style="padding:10px 0 0 0 !important;"], :root a[href^="http://feedads.g.doubleclick.net/"], :root a[href^="http://betahit.click/"], :root a[href^="http://bestorican.com/"], :root a[href^="http://bcp.crwdcntrl.net/"], :root a[href^="http://bc.vc/?r="], :root a[href^="http://www.pheedo.com/"], :root a[href^="http://banners.victor.com/processing/"], :root a[href^="http://adf.ly/?id="], :root a[href^="https://uncensored3d.com/"], :root a[href^="http://t.mdn2015x2.com/"], :root div[data-subscript="Advertising"], :root div[class$="dealnews"] > .dealnews, :root a[href^="http://click.payserve.com/"], :root a[href^="http://api.ringtonematcher.com/"], :root a[href^="http://affiliate.glbtracker.com/"], :root a[href^="https://transfer.xe.com/signup/track/redirect?"], :root a[href^="http://anonymous-net.com/"], :root a[href^="https://www.dsct1.com/"], :root a[data-oburl^="https://paid.outbrain.com/network/redir?"], :root .icons-rss-feed + .icons-rss-feed div[class$="_item"], :root a[href^="http://aflrm.com/"], :root a[href^="http://affiliates.pinnaclesports.com/processing/"], :root a[href^="http://affiliate.godaddy.com/"], :root a[href^="http://partner.sbaffiliates.com/"], :root a[href^="http://affiliate.coral.co.uk/processing/"], :root a[href^="http://aff.ironsocket.com/"], :root a[href^="http://adsrv.keycaptcha.com"], :root a[data-redirect^="https://paid.outbrain.com/network/redir?"], :root a[href^="http://play4k.co/"], :root a[href^="http://adserving.liveuniversenetwork.com/"], :root a[href^="https://zononi.com/"], :root a[href^="http://adserving.unibet.com/"], :root a[href^="http://adtransfer.net/"], :root a[href^="http://adserver.itsfogo.com/"], :root a[href^="https://secure.adnxs.com/clktrb?"], :root a[href^="http://adserver.adtechus.com/"], :root a[href^="http://adserver.adreactor.com/"], :root a[href^="http://www.yourfuckbook.com/?"], :root a[href^="//go.onclasrv.com/"], :root .GHOFUQ5BG2 > .GHOFUQ5BF2 > .GHOFUQ5BG5, :root .__ywvr .__y_item, :root #\5f _mom_ad_12, :root a[href^="http://ads.integral-marketing.com/"], :root a[href^="http://adserver.adtech.de/"], :root a[href^="http://cwcams.com/landing/click/"], :root a[href^="http://ads.betfair.com/redirect.aspx?"], :root a[href^="http://ads.affbuzzads.com/"], :root a[href^="http://tc.tradetracker.net/"], :root a[href^="http://online.ladbrokes.com/promoRedirect?"], :root a[href^="http://go.trafficshop.com/"], :root a[href^="http://ads.ad-center.com/"], :root div[id^="advt-"], :root a[href^="http://admingame.info/"], :root div[id^="q1-adset-"], :root a[href^="http://adfarm.mediaplex.com/"], :root a[href^="http://ad.doubleclick.net/"], :root a[href^="https://understandsolar.com/signup/?lead_source="][href*="&tracking_code="], :root a[href^="http://ad-emea.doubleclick.net/"], :root a[href*="/servlet/click/zone?"], :root a[href^="http://ad-apac.doubleclick.net/"], :root script[src^="http://free-shoutbox.net/app/webroot/shoutbox/sb.php?shoutbox="] + #freeshoutbox_content, :root a[href^="http://hdplugin.flashplayer-updates.com/"], :root .trc_rbox_div .syndicatedItem, :root a[href^="http://data.ad.yieldmanager.net/"], :root a[href^="http://a63t9o1azf.com/"], :root a[href^="http://srvpub.com/"], :root a[href^="http://a.adquantix.com/"], :root a[href^="http://NowDownloadAll.com"], :root #assetsListings[style="display: block;"], :root a[href^="http://9nl.es/"], :root a[href^="http://abc2.mobile-10.com/"], :root a[href^="http://adtrack123.pl/"], :root [id*="MGWrap"], :root a[href^="http://9amq5z4y1y.com/"], :root a[href^="http://4c7og3qcob.com/"], :root a[href^="//go.vedohd.org/"], :root a[href^="http://www.ducksnetwork.com/"], :root a[href^="http://3wr110.net/"], :root a[href^="http://www5.smartadserver.com/call/pubjumpi/"], :root a[href^="http://1phads.com/"], :root #MAIN.ShowTopic > .ad, :root a[href^="https://porngames.adult/?SID="], :root a[href^="http://findersocket.com/"], :root a[href^="https://m.do.co/c/"] > img, :root a[href^="http://connectlinking6.com/"], :root a[href^="https://spygasm.com/track?"], :root a[href^="http://cdn3.adexprts.com/"], :root #tads + div + .c, :root a[href^="//jsmptjmp.com/"], :root a[href^="https://ilovemyfreedoms.com/"][href*="?affiliate_id="], :root a[href^="//healthaffiliate.center/"], :root a[href^="http://games.ucoz.ru/"][target="_blank"], :root [id*="ScriptRoot"], :root a[href^="//db52cc91beabf7e8.com/"], :root a[href^="http://ads.activtrades.com/"], :root div[id^="drudge-column-ads-"], :root .plistaList > .plista_widget_underArticle_item[data-type="pet"], :root #center_col > #taw > #tvcap > .commercial-unit-desktop-top, :root a[href^="http://www.afgr2.com/"], :root #mn div[style="position:relative"] > #center_col > ._Ak, :root a[href^="https://www.oboom.com/ad/"], :root a[href^="//4f6b2af479d337cf.com/"], :root a[href^="https://www.friendlyduck.com/AF_"], :root #center_col > #resultStats + div + #res + #tads, :root a[href^="//40ceexln7929.com/"], :root div[id^="div-gpt-ad"], :root a[href^="http://fusionads.net"], :root a[href^=" http://www.sex.com/"][href*="&utm_"], :root .section-result[data-result-ad-type], :root a[href^=" http://ads.ad-center.com/"], :root div[id^="dfp-slot-"], :root .l-container > #fishtank, :root a[href^="https://fileboom.me/pr/"], :root .GPMV2XEDA2 > .GPMV2XEDP1 > .GPMV2XEDJBB, :root a[href*="onclkds."], :root #ads > .dose > .dosesingle, :root a[href*="delivery.trafficfabrik.com"], :root a[href*="=exoclick"], :root div[class^="backfill-taboola-home-slot-"], :root a[href*="=adscript"], :root #mn #center_col > div > h2.spon:first-child, :root FBS-AD, :root .ra[align="right"][width="30%"], :root a[href*="5iclx7wa4q.com"], :root a[href*=".revimedia.com/"], :root [lazy-ad="leftbottom_banner"], :root p[id^="div-gpt-ad-"], :root a[href^="http://fsoft4down.com/"], :root a[href*="ad2upapp.com/"], :root .inlineNewsletterSubscription + .inlineNewsletterSubscription div[class$="_item"], :root #taw > .med + div > #tvcap > .mnr-c:not(.qs-ic) > .commercial-unit-mobile-top, :root .plista_widget_belowArticleRelaunch_item[data-type="pet"], :root div[data-mediatype="advertising"], :root .mw > #rcnt > #center_col > #taw > #tvcap > .c, :root a[href^="https://playuhd.host/"], :root a[href^="http://mgid.com/"], :root a[href*=".adsrv.eacdn.com/"] > img, :root a[href^="http://lp.ilivid.com/"], :root a[href^="http://secure.hostgator.com/~affiliat/"], :root [onclick^="window.open('http://adultfriendfinder.com/search/"], :root a[href^="http://data.committeemenencyclopedicrepertory.info/"], :root a[href*=".allsports4you.club"], :root a[href^="http://spygasm.com/track?"], :root .ob_dual_right > .ob_ads_header ~ .odb_div, :root a[href*=".adk2x.com/"], :root a[href^="http://duckcash.eu/"], :root a[href^="http://www.mobileandinternetadvertising.com/"], :root .GB3L-QEDGY .GB3L-QEDF- > .GB3L-QEDE-, :root a[data-url^="http://paid.outbrain.com/network/redir?"] + .author, :root a[href^="http://liversely.net/"], :root .ra[width="30%"][align="right"] + table[width="70%"][cellpadding="0"], :root iframe[id^="google_ads_frame"], :root a[href^="http://www.bluehost.com/track/"] > img, :root a[data-url^="http://paid.outbrain.com/network/redir?"], :root a[href^="http://n.admagnet.net/"], :root a[href^="http://bestchickshere.com/"], :root a[href^="http://www.streamtunerhd.com/signup?"], :root #ssmiwdiv[jsdisplay], :root a[href^="//awejmp.com/"], :root a[href^="http://www.getyourguide.com/?partner_id="], :root [onclick^="window.open('https://www.brazzersnetwork.com/landing/"], :root a[href*="a2g-secure.com"], :root #resultspanel > #topads, :root a[href^="http://espn.zlbu.net/"], :root a[href^="http://k2s.cc/pr/"], :root [onclick^="window.open('window.open('//delivery.trafficfabrik.com/"], :root a[href^="http://adrunnr.com/"], :root [lazy-ad="leftthin_banner"], :root [id*="MarketGid"], :root a[href^="http://www.accuserveadsystem.com/accuserve-go.php?"], :root a[href^="http://c.ketads.com/"], :root a[href^="http://6kup12tgxx.com/"], :root a[target="_blank"][onmousedown="this.href^='http://paid.outbrain.com/network/redir?"], :root a[href^="http://hd-plugins.com/download/"], :root a[href^="//voyeurhit.com/cs/"], :root a[href^="http://www.afgr3.com/"], :root [ad-id^="googlead"], :root a[href^="https://topoffers.com/"][href*="/?pid="], :root a[href^="http://vinfdv6b4j.com/"], :root a[href^="http://bonusfapturbo.nmvsite.com/"], :root a[href^="//porngames.adult/?SID="], :root DFP-AD, :root a[href^="//www.mgid.com/"], :root #center_col > div[style="font-size:14px;margin-right:0;min-height:5px"] > div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff8e7"], :root a[href^="http://track.affiliatenetwork.co.za/"], :root a[data-redirect^="http://paid.outbrain.com/network/redir?"], :root .jobs-information-call-to-action + .jobs-information-call-to-action div[class$="_item"], :root a[href^="http://servicegetbook.net/"], :root #rhs_block > #mbEnd, :root a[href^="http://cinema.friendscout24.de?"], :root [lazy-ad="lefttop_banner"], :root .__y_inner > .__y_item, :root a[href^="https://secure.cbdpure.com/aff/"], :root AMP-AD, :root a[href^="http://adclick.g.doubleclick.net/"], :root #main-content > [style="padding:10px 0 0 0 !important;"], :root #center_col > #resultStats + div[style="border:1px solid #dedede;margin-bottom:11px;padding:5px 7px 5px 6px"], :root div[class^="lifeOnwerAd"], :root a[data-oburl^="http://paid.outbrain.com/network/redir?"], :root iframe[src^="http://cdn1.adexprt.com/"], :root a[href^="http://dwn.pushtraffic.net/"], :root a[href$="/vghd.shtml"], :root a[href^="https://redirect.ero-advertising.com/"], :root a[href^="http://easydownload4you.com/"], :root a[href^="http://ffxitrack.com/"], :root #center_col > #main > .dfrd > .mnr-c > .c._oc._zs, :root a[href^="http://b.bestcompleteusa.info/"], :root .trc_rbox_div .syndicatedItemUB, :root #mn div[style="position:relative"] > #center_col > div > ._dPg, :root a[href^="http://www.myvpn.pro/"], :root a[href^="//www.pd-news.com/"], :root a[href^="http://www.pinkvisualpad.com/?revid="], :root a[href*=".clksite.com/"], :root a[href^="http://www.webtrackerplus.com/"], :root .GJJKPX2N1 > .GJJKPX2M1 > .GJJKPX2P4, :root #center_col > #taw > #tvcap > .cu-container > .commercial-unit-desktop-top, :root a[href^="http://centertrust.xyz/"], :root a[href^="https://intrev.co/"], :root div[id^="google_ads_iframe_"], :root .vi-lb-placeholder[title="ADVERTISEMENT"], :root a[href^="http://goldmoney.com/?gmrefcode="], :root a[href^="http://papi.mynativeplatform.com:80/pub2/"], :root LEADERBOARD-AD, :root #mn #center_col > div > h2.spon:first-child + ol:last-child, :root a[href^="https://bongacams2.com/track?"], :root a[href^="//zenhppyad.com/"], :root .gbfwa > div[class$="_item"], :root a[href^="http://www.menaon.com/installs/"], :root a[href^="http://taboola-"][href*="/redirect.php?app.type="], :root .mw > #rcnt > #center_col > #taw > .c, :root a[href^="http://api.content.ad/"], :root a[href*=".clkcln.com/"], :root .commercial-unit-desktop-rhs > .iKidV > .Ee92ae + .P2mpm + .hp3sk, :root a[href^="http://prochina.space/"], :root a[href^="http://www.uniblue.com/cm/"], :root a[href^="http://landingpagegenius.com/"], :root a[data-redirect^="http://click.plista.com/pets"], :root #rhs_block > script + .c._oc._Ve.rhsvw, :root .__zinit .__y_item, :root .ch[onclick="ga(this,event)"], :root a[href^="http://track.incognitovpn.com/"], :root .__ywl .__y_item, :root a[href^="http://track.trkvluum.com/"], :root a[href*="/adrotate-out.php?"], :root a[href^="http://linksnappy.com/?ref="], :root [src^="/Redirect.a2b?"], :root a[href^="http://www.torntvdl.com/"], :root #center_col > #resultStats + #tads, :root .__yinit .__y_item, :root .ra[align="left"][width="30%"], :root a[href^="https://trackjs.com/?utm_source"], :root AFS-AD, :root #cnt #center_col > #res > #topstuff > .ts, :root a[href^="https://landing.brazzersnetwork.com/"], :root a[href^="http://www.firstclass-download.com/"], :root a[href*=".trust.zone"], :root a[href*="googleme.eu"], :root .mod > ._jH + .rscontainer, :root .GFYY1SVD2 > .GFYY1SVC2 > .GFYY1SVF5, :root a[href^="https://dcs.adgear.com/clicks/"], :root a[href^="http://affiliates.score-affiliates.com/"], :root #rhswrapper > #rhssection[border="0"][bgcolor="#ffffff"], :root .Mpopup + #Mad > #MadZone, :root a[href^="https://www.adxtro.com/"], :root #center_col > #\5f Emc, :root div[id^="dfp-ad-"], :root a[href^="http://ads2.williamhill.com/redirect.aspx?"], :root a[href^="https://www.spyoff.com/"], :root AD-TRIPLE-BOX, :root a[href^="//z6naousb.com/"], :root .rc-cta[data-target], :root #rhs_block > .ts[cellspacing="0"][cellpadding="0"][style="padding:0"], :root #header + #content > #left > #rlblock_left, :root a[href^="http://www.seekbang.com/cs/"], :root a[href^="http://syndication.exoclick.com/"], :root a[href^="http://bluehost.com/track/"], :root a[href^="https://squren.com/rotator/?atomid="], :root .nrelate .nr_partner, :root #center_col > #resultStats + #tads + #res + #tads, :root a[href^="//medleyads.com/spot/"], :root a[href*="mfroute.com/"], :root #rhs_block > ol > .rhsvw > .kp-blk > .xpdopen > ._OKe > ol > ._DJe > .luhb-div, :root a[href^="http://tezfiles.com/pr/"], :root a[href^="http://t.wowtrk.com/"], :root #center_col > #taw > #tvcap > .rscontainer, :root #main_col > #center_col div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff7ed"], :root a[href^="http://webtrackerplus.com/"], :root a[href^="http://clickandjoinyourgirl.com/"], :root div[itemtype="http://schema.org/WPAdBlock"], :root a[href^="https://www.nudeidols.com/cams/"], :root #center_col > #res > #topstuff + #search > div > #ires > #rso > #flun, :root a[href^="http://www.sex.com/pics/?utm_"], :root a[href^="http://vo2.qrlsx.com/"], :root a[href^="http://engine.newsmaxfeednetwork.com/"], :root a[href^="http://ad.yieldmanager.com/"], :root a[href^="http://www.plus500.com/?id="], :root #flowplayer > div[style="z-index: 208; position: absolute; width: 300px; height: 275px; left: 222.5px; top: 85px;"], :root a[href^="http://ddownload39.club/"], :root a[href^="http://n217adserv.com/"], :root a[href^="//4c7og3qcob.com/"] { display: none !important; }</style></head>
<body class="article">
<div id="header">
<h1>Lab Guide: Vulnerability Risk Management with Elastic</h1>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/#_general_guidance">GENERAL GUIDANCE</a></li>
<li><a href="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/#lab1">LAB 1: EXPLORE DATASETS AND MODEL DATA</a></li>
<li><a href="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/#_lab_2a_transform_and_load_data_part_1">LAB 2A: TRANSFORM AND LOAD DATA - PART 1</a></li>
<li><a href="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/#_lab_2b_transform_and_load_data_part_2">LAB 2B: TRANSFORM AND LOAD DATA - PART 2</a></li>
<li><a href="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/#_lab_2c_transform_and_load_data_part_3">LAB 2C: TRANSFORM AND LOAD DATA - PART 3</a></li>
<li><a href="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/#_lab_3_explore_and_visualize">LAB 3: EXPLORE AND VISUALIZE</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_general_guidance">GENERAL GUIDANCE</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lab can be accessed by clicking on Lab Icon in Left Nav Pane</p>
</li>
<li>
<p>This will drop you into a shell. You can open any number of shell instances as you want by clicking .on the + sign next to the tab containing the shell.</p>
</li>
<li>
<p>Many steps would require you to run scripts in the foreground. Please bear in mind that closing a shell tab will kill the foreground process.</p>
</li>
<li>
<p>Some labs require you to start elasticsearch and kibana. Please go over the instructions to make sure you have gotten to that point in the instructions before trying to access kibana.</p>
</li>
<li>
<p>You can get the public DNS for your machine running in AWS using the gear icon up on Top and clicking on “Machine Info”. Copy the public DNS to the clipboard and paste it into a new browser tab, append :5601 and hit go to access kibana.</p>
</li>
<li>
<p>In order to make RESTful request to elasticsearch, we will use Kibana’s Dev Tools &gt; Console UI</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/resources/lab.png" alt="lab">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lab1">LAB 1: EXPLORE DATASETS AND MODEL DATA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objective">OBJECTIVE</h3>
<div class="paragraph">
<p>Get familiar with the datasets, their locations and schema. Based on the data, define schema for data, create index mappings and templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instructions">INSTRUCTIONS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Explore directories and sample files under /home/ubuntu/vrm</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Everything that you need for these labs have been placed inside of the vrm folder in the home directory.
Change into /home/ubuntu/vrm directory.</p>
</li>
<li>
<p>Scan reports generated by two different vulnerability scanners have been placed into the “fbdata” folder. Explore the structure of this folder.</p>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
tree command line tool has been installed, you can use the following in order to visually see the tree structure of this directory.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">tree fbdata</code></pre>
</div>
</div>
</li>
<li>
<p>Change into the fbdata directory. We have both csv reports and new line delimited json version of the reports in these sub-directories. Explore the first few lines of the each lines.</p>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can either use head &lt;file_name&gt;.csv or use the less tool to explore csv files in read-only mode. We have installed ‘jq’ to help you explore json data. You can use jq as follows
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">head -<span class="integer">1</span> openvas/dvl.json | jq</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using an editor like vim or nano, please ensure data is not changed in anyway.
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>Change in to the fbdata directory. We have both csv reports and new line delimited json version of the reports in these sub-directories. Explore the first few lines of the each lines.</p>
</li>
<li>
<p>Notice the multiline pattern in the csv files. This will pose a challenge in the next lab that we will overcome using a few techniques. Make a note of the fields and based on the sampled data.</p>
</li>
<li>
<p>Come up with the mappings that would be appropriate based on searches and aggregations that we may want on this type of data.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Model scan data in elasticsearch</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Access your Kibana instance as explained in the "General Guidance" section above (your_public_DNS:5601) in a new browser tab.</p>
</li>
<li>
<p>In Kibana, switch to “Dev Tools” &gt; “Console” and Index a few random documents for nessus and openvas reports into a couple of test indices ("test_nessus", "test_openvas").</p>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can use shuf with jq to get a random document for nessus and openvas reports on dvl (damn vulnerable linux) and metasploitable.
Copy the resulting json documents  and index then into test_nessus and test_openvas indices respectively.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT test_nessus/_doc/<span class="integer">1</span>
{
  <span class="key"><span class="delimiter">"</span><span class="content">Plugin ID</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">58966</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">CVE</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">CVE-2012-1172</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">CVSS</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">7.5</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Risk</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">High</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Host</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">172.16.144.142</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Protocol</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">tcp</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Port</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">80</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">PHP &lt; 5.3.11 Multiple Vulnerabilities</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Synopsis</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">The remote web server uses a version of PHP that is affected by </span><span class="char">\n</span><span class="content">multiple vulnerabilities.</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">According to its banner, the version of PHP installed on the remote</span><span class="char">\n</span><span class="content">host is earlier than 5.3.11, and as such is potentially affected by</span><span class="char">\n</span><span class="content">multiple vulnerabilities :</span><span class="char">\n</span><span class="char">\n</span><span class="content"> - During the import of environment variables, temporary</span><span class="char">\n</span><span class="content">   changes to the 'magic_quotes_gpc' directive are not</span><span class="char">\n</span><span class="content">   handled properly. This can lower the difficulty for</span><span class="char">\n</span><span class="content">   SQL injection attacks. (CVE-2012-0831)</span><span class="char">\n</span><span class="char">\n</span><span class="content"> - The '$_FILES' variable can be corrupted because the</span><span class="char">\n</span><span class="content">   names of uploaded files are not properly validated.</span><span class="char">\n</span><span class="content">   (CVE-2012-1172)</span><span class="char">\n</span><span class="char">\n</span><span class="content"> - The 'open_basedir' directive is not properly handled by</span><span class="char">\n</span><span class="content">   the functions 'readline_write_history' and</span><span class="char">\n</span><span class="content">   'readline_read_history'.</span><span class="char">\n</span><span class="char">\n</span><span class="content">  - The 'header()' function does not detect multi-line</span><span class="char">\n</span><span class="content">    headers with a CR. (Bug #60227 / CVE-2011-1398)</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Solution</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Upgrade to PHP version 5.3.11 or later.</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">See Also</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">http://www.nessus.org/u?e81d4026</span><span class="char">\n</span><span class="content">https://bugs.php.net/bug.php?id=61043</span><span class="char">\n</span><span class="content">https://bugs.php.net/bug.php?id=54374</span><span class="char">\n</span><span class="content">https://bugs.php.net/bug.php?id=60227</span><span class="char">\n</span><span class="content">http://marc.info/?l=oss-security&amp;m=134626481806571&amp;w=2</span><span class="char">\n</span><span class="content">http://www.php.net/archive/2012.php#id2012-04-26-1</span><span class="char">\n</span><span class="content">http://www.php.net/ChangeLog-5.php#5.3.11</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Plugin Output</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="char">\n</span><span class="content">  Version source     : Server: Apache/1.3.37 (Unix) PHP/4.4.4</span><span class="char">\n</span><span class="content">  Installed version  : 4.4.4</span><span class="char">\n</span><span class="content">  Fixed version      : 5.3.11</span><span class="char">\n</span><span class="delimiter">"</span></span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT test_openvas/_doc/<span class="integer">1</span>
{
  <span class="key"><span class="delimiter">"</span><span class="content">IP</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">172.16.144.142</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Hostname</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Port</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Port Protocol</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">CVSS</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">10.0</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Severity</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">High</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Solution Type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">VendorFix</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">NVT Name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Adobe Flash Player Multiple Vulnerabilities-01 July13 (Linux)</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Summary</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">This host is installed with Adobe Flash Player and is prone to multiple</span><span class="char">\n</span><span class="content">vulnerabilities.</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Specific Result</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vulnerability was detected according to the Vulnerability Detection Method.</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">NVT OID</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">1.3.6.1.4.1.25623.1.0.803833</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">CVEs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">CVE-2013-3347, CVE-2013-3345, CVE-2013-3344</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Task ID</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">10ca402a-1cbf-401c-b23b-c1b032f90cbd</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Task Name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">host2_scan1</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Timestamp</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2018-09-24T13:28:19Z</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Result ID</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">8c64b8e1-1781-4f93-9b9e-a59c222e11e3</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Impact</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Successful exploitation will allow remote attackers to execute arbitrary</span><span class="char">\n</span><span class="content">code on the target system will cause heap-based buffer overflow or cause</span><span class="char">\n</span><span class="content">memory corruption via unspecified vectors.</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Solution</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Update to Adobe Flash Player version 11.2.202.297 or later,</span><span class="char">\n</span><span class="content">For updates refer to  http://get.adobe.com/flashplayer</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Affected Software/OS</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Adobe Flash Player before 11.2.202.297 on Linux</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Vulnerability Insight</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Multiple unspecified error exists and an integer overflow error exists</span><span class="char">\n</span><span class="content">when resampling a PCM buffer.</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Vulnerability Detection Method</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Get the installed version with the help of detect NVT and check the version</span><span class="char">\n</span><span class="content">is vulnerable or not.</span><span class="char">\n</span><span class="content">Details:</span><span class="char">\n</span><span class="content">Adobe Flash Player Multiple Vulnerabilities-01 July13 (Linux)</span><span class="char">\n</span><span class="content">(OID: 1.3.6.1.4.1.25623.1.0.803833)</span><span class="char">\n</span><span class="content">Version used: $Revision: 9353 $</span><span class="char">\n</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Product Detection Result</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">BIDs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">61048,  61045,  61043</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">CERTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">DFN-CERT-2013-1322, DFN-CERT-2013-1292, DFN-CERT-2013-1275, DFN-CERT-2013-1270</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">Other References</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">http://secunia.com/advisories/53975, http://www.adobe.com/support/security/bulletins/apsb13-17.html</span><span class="delimiter">"</span></span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Get the mappings that were dynamically generated for these test indices by elasticsearch. Take some time to explore other options for field data types that might be more appropriate for our use case.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET test_nessus/_mapping</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET test_openvas/_mapping</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Most string fields should be mapped as keyword except when you think a full text search will be useful. An example of this type of field would be the “Description” field. If full text search is all you would need, then we don’t need the keyword flavor of the field.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
There are some fields that contain url as reference. There are some tokenizers that are friendlier to urls than others. You can learn more about tokenizers <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html#analysis-tokenizers">here</a> and more specifically about url_uax_email tokenizer <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-uaxurlemail-tokenizer.html">here</a>.
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>Tweak and make changes to these mappings to meet our needs. The goals is to explicitly define mappings (schema) for our indices defined inside a template that will automate applying these settings when our production indices are created. But we can also pack other settings inside of templates like an alias. You can learn more about aliases <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-aliases.html">here</a></p>
</li>
<li>
<p>Let’s create an index templates for openvas and nessus indices with the refined mappings.</p>
</li>
<li>
<p>Let’s also add an alias ‘scan_results’ that maps to both openvas and nessus indices.</p>
</li>
<li>
<p>Let’s also define the number of shards to be 1 as the size of this dataset doesn’t warrant more than 1 shard. You can learn more about shards <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_basic_concepts.html#getting-started-shards-and-replicas">here</a></p>
</li>
<li>
<p>Use the following table to create the index templates</p>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template</th>
<th class="tableblock halign-left valign-top">Index Pattern</th>
<th class="tableblock halign-left valign-top">Alias</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openvas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[openvas*]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scan_results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nessus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[nessus*]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scan_results</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT _template/nessus
{
 <span class="key"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>: <span class="integer">5</span>,
 <span class="key"><span class="delimiter">"</span><span class="content">index_patterns</span><span class="delimiter">"</span></span>: [
   <span class="string"><span class="delimiter">"</span><span class="content">nessus*</span><span class="delimiter">"</span></span>
 ],
 <span class="key"><span class="delimiter">"</span><span class="content">settings</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">index</span><span class="delimiter">"</span></span>: {
     <span class="key"><span class="delimiter">"</span><span class="content">analysis</span><span class="delimiter">"</span></span>: {
       <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>: {
           <span class="key"><span class="delimiter">"</span><span class="content">tokenizer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">uax_url_email</span><span class="delimiter">"</span></span>
         }
       }
     },
     <span class="key"><span class="delimiter">"</span><span class="content">number_of_shards</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span>
   }
 },
 <span class="key"><span class="delimiter">"</span><span class="content">mappings</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">doc</span><span class="delimiter">"</span></span>: {
     <span class="key"><span class="delimiter">"</span><span class="content">properties</span><span class="delimiter">"</span></span>: {
       <span class="key"><span class="delimiter">"</span><span class="content">CVE</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">CVSS</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">float</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Description</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Host</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Port</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">integer</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Protocol</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Risk</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">See Also</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Solution</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Synopsis</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       }
     }
   }
 },
 <span class="key"><span class="delimiter">"</span><span class="content">aliases</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">scan_results</span><span class="delimiter">"</span></span>: {}
 }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Repeat the same process for openvas data</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT _template/openvas
{
 <span class="key"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>: <span class="integer">5</span>,
 <span class="key"><span class="delimiter">"</span><span class="content">index_patterns</span><span class="delimiter">"</span></span>: [
   <span class="string"><span class="delimiter">"</span><span class="content">openvas*</span><span class="delimiter">"</span></span>
 ],
 <span class="key"><span class="delimiter">"</span><span class="content">settings</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">index</span><span class="delimiter">"</span></span>: {
     <span class="key"><span class="delimiter">"</span><span class="content">analysis</span><span class="delimiter">"</span></span>: {
       <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>: {
           <span class="key"><span class="delimiter">"</span><span class="content">tokenizer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">uax_url_email</span><span class="delimiter">"</span></span>
         }
       }
     },
     <span class="key"><span class="delimiter">"</span><span class="content">number_of_shards</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span>
   }
 },
 <span class="key"><span class="delimiter">"</span><span class="content">mappings</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">doc</span><span class="delimiter">"</span></span>: {
     <span class="key"><span class="delimiter">"</span><span class="content">properties</span><span class="delimiter">"</span></span>: {
       <span class="key"><span class="delimiter">"</span><span class="content">Affected Software/OS</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">BIDs</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">CERTs</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">CVEs</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">CVSS</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">float</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Hostname</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">IP</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">ip</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Impact</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">NVT Name</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">fields</span><span class="delimiter">"</span></span>: {
           <span class="key"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>: {
             <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>,
             <span class="key"><span class="delimiter">"</span><span class="content">ignore_above</span><span class="delimiter">"</span></span>: <span class="integer">256</span>
           }
         }
       },
       <span class="key"><span class="delimiter">"</span><span class="content">NVT OID</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Other References</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Port</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">integer</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Port Protocol</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Product Detection Result</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Result ID</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Severity</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Solution</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Solution Type</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Specific Result</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Summary</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Task ID</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Task Name</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">keyword</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Timestamp</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Vulnerability Detection Method</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       },
       <span class="key"><span class="delimiter">"</span><span class="content">Vulnerability Insight</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">analyzer</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">url_aware</span><span class="delimiter">"</span></span>
       }
     }
   }
 },
 <span class="key"><span class="delimiter">"</span><span class="content">aliases</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">scan_results</span><span class="delimiter">"</span></span>: {}
 }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Feel free to index a few documents and run queries and aggregations and test if indices are being created with the settings in the template and if they are behaving according to the mapping.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2a_transform_and_load_data_part_1">LAB 2A: TRANSFORM AND LOAD DATA - PART 1</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objective_2">OBJECTIVE</h3>
<div class="paragraph">
<p>Transform and load scan results using filebeat and ingest pipelines.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instructions_2">INSTRUCTIONS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure filebeat to tail and ship json files to elasticsearch</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>All of the data that we want filebeat to pickup are in /home/ubuntu/vrm/fbdata directory Create necessary configuration files inside /home/ubuntu/vrm/fbconfig directory Create a blank fb2es.yml file. The configuration should look like this</p>
</li>
<li>
<p>Scan reports generated by two different vulnerability scanners have been placed into the “fbdata” folder. Explore the structure of this folder.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">filebeat.inputs</span>:
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/*/*.json</span></span>
<span class="key">filebeat.config.modules</span>:
 <span class="key">path</span>: <span class="string"><span class="content">${path.config}/modules.d/*.yml</span></span>
 <span class="key">reload.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">setup.template.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">output.elasticsearch</span>:
 <span class="key">hosts</span>: <span class="string"><span class="content">["localhost:9200"]</span></span>
 <span class="key">indices</span>:
   - <span class="string"><span class="content">index: "scan_load_test"</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Run filebeat (from the vrm directory) to index this data into a scan_load_test index. Use the -c flag to point filebeat to use /home/ubuntu/vrm/fbconfig/fb2es.yml. Also, use the -e flag to display error in stdout</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">filebeat/filebeat -c fbconfig/fb2es.yml -e</code></pre>
</div>
</div>
</li>
<li>
<p>Run quick searches on scan_load_test index to check document format.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET scan_load_test/_search
{
 <span class="key"><span class="delimiter">"</span><span class="content">query</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">match</span><span class="delimiter">"</span></span>: {
     <span class="key"><span class="delimiter">"</span><span class="content">source.keyword</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">/home/ubuntu/vrm/fbdata/nessus/dvl.json</span><span class="delimiter">"</span></span>
   }
 }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"> GET scan_load_test/_search
{
 <span class="key"><span class="delimiter">"</span><span class="content">query</span><span class="delimiter">"</span></span>: {
   <span class="key"><span class="delimiter">"</span><span class="content">match</span><span class="delimiter">"</span></span>: {
     <span class="key"><span class="delimiter">"</span><span class="content">source.keyword</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">/home/ubuntu/vrm/fbdata/openvas/dvl.json</span><span class="delimiter">"</span></span>
   }
 }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Do you see any problems with this data? How can we improve it?</p>
</li>
</ol>
</div>
</li>
<li>
<p>Based on sample documents ingested, create required ingest pipelines</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create an ingest pipeline to parse the message field and index them into the root of the document. Once that is done, there is no need for the message field so delete it.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT _ingest/pipeline/scan
{
 <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">parse and index json fields</span><span class="delimiter">"</span></span>,
 <span class="key"><span class="delimiter">"</span><span class="content">processors</span><span class="delimiter">"</span></span>: [
   {
     <span class="key"><span class="delimiter">"</span><span class="content">json</span><span class="delimiter">"</span></span>: {
       <span class="key"><span class="delimiter">"</span><span class="content">field</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>,
       <span class="key"><span class="delimiter">"</span><span class="content">add_to_root</span><span class="delimiter">"</span></span>: <span class="predefined-constant">true</span>
     }
   },
   {
     <span class="key"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span>: {
       <span class="key"><span class="delimiter">"</span><span class="content">field</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>
     }
   }
 ]
}</code></pre>
</div>
</div>
</li>
<li>
<p>Make a copy of fb2es.yml to fb2ingest.yml and modify it to use the pipeline</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">cp fbconfig/fb2es.yml fbconfig/fb2ingest.yml</code></pre>
</div>
</div>
</li>
<li>
<p>The resulting configuration should look like this</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">filebeat.inputs</span>:
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/*/*.json</span></span>
<span class="key">filebeat.config.modules</span>:
 <span class="key">path</span>: <span class="string"><span class="content">${path.config}/modules.d/*.yml</span></span>
 <span class="key">reload.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">setup.template.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">output.elasticsearch</span>:
 <span class="key">hosts</span>: <span class="string"><span class="content">["localhost:9200"]</span></span>
 <span class="key">indices</span>:
   - <span class="string"><span class="content">index: "scan_load_test"</span></span>
 <span class="key">pipelines</span>:
   - <span class="string"><span class="content">pipeline: "scan"</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Kill filebeat instance, delete the scan_load_test index and filebeat registry file and reingest using the new configuration file</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE scan_load_test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">rm filebeat/data/registry
filebeat/filebeat -c fbconfig/fb2ingest.yml -e</code></pre>
</div>
</div>
</li>
<li>
<p>Run the same 2 searches that we ran above and check the structure of the documents for openvas and nessus reports.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>What are some glaring differences between nessus and openvas documents?</p>
</li>
<li>
<p>Can we make any other improvements? What’s the difference between the fields that contain CVE information in nessus report and openvas report?</p>
</li>
<li>
<p>Is it possible to route openvas and nessus documents to different pipelines?</p>
</li>
</ol>
</div>
</li>
<li>
<p>Check out these documentation on</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><a href="https://www.elastic.co/guide/en/beats/filebeat/current/elasticsearch-output.html#_literal_pipelines_literal">configuring filebeat for ingest pipelines</a></p>
</li>
<li>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/split-processor.html">split ingest pipeline processor</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>With the "scan" pipeline defined before as the base, create a new pipeline that also splits the “CVEs” field and “Other References” field into an array.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">PUT _ingest/pipeline/openvas
{
 <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">to process openvas report</span><span class="delimiter">"</span></span>,
   <span class="key"><span class="delimiter">"</span><span class="content">processors</span><span class="delimiter">"</span></span>: [
     {
       <span class="key"><span class="delimiter">"</span><span class="content">json</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">field</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">add_to_root</span><span class="delimiter">"</span></span>: <span class="predefined-constant">true</span>
       }
     },
     {
       <span class="key"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">field</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>
       }
     },
     {
       <span class="key"><span class="delimiter">"</span><span class="content">split</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">field</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">CVEs</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">separator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">,</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">ignore_missing</span><span class="delimiter">"</span></span>: <span class="predefined-constant">true</span>
       }
     },
     {
       <span class="key"><span class="delimiter">"</span><span class="content">split</span><span class="delimiter">"</span></span>: {
         <span class="key"><span class="delimiter">"</span><span class="content">field</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Other References</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">separator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">,</span><span class="delimiter">"</span></span>,
         <span class="key"><span class="delimiter">"</span><span class="content">ignore_missing</span><span class="delimiter">"</span></span>: <span class="predefined-constant">true</span>
       }
     }
   ]
}</code></pre>
</div>
</div>
</li>
<li>
<p>Kill filbeat instance and modify fb2ingest.yml file. Duplicate the logs input stanzas and modify them to pick up json files separately while tagging them with a field “scanner” whose value is set to either “nessus” or “openvas” based on the input. Add when clauses to the pipelines stanza of the output section. The resulting configuration file should look like this</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">filebeat.inputs</span>:
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/nessus/*.json</span></span>
 <span class="key">fields</span>:
   <span class="key">scanner</span>: <span class="string"><span class="content">nessus</span></span>
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/openvas/*.json</span></span>
 <span class="key">fields</span>:
   <span class="key">scanner</span>: <span class="string"><span class="content">openvas</span></span>
<span class="key">filebeat.config.modules</span>:
 <span class="key">path</span>: <span class="string"><span class="content">${path.config}/modules.d/*.yml</span></span>
 <span class="key">reload.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">setup.template.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">output.elasticsearch</span>:
 <span class="key">hosts</span>: <span class="string"><span class="content">["localhost:9200"]</span></span>
 <span class="key">indices</span>:
   - <span class="string"><span class="content">index: "scan_load_test"</span></span>
 <span class="key">pipelines</span>:
   - <span class="string"><span class="content">pipeline: "scan"</span></span>
     <span class="key">when.equals</span>:
       <span class="key">fields.scanner</span>: <span class="string"><span class="content">nessus</span></span>
   - <span class="string"><span class="content">pipeline: "openvas"</span></span>
     <span class="key">when.equals</span>:
       <span class="key">fields.scanner</span>: <span class="string"><span class="content">openvas</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Delete the scan_load_test index and filebeat registry file and reingest using the modified version of the configuration file</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE scan_load_test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">rm filebeat/data/registry
filebeat/filebeat -c fbconfig/fb2ingest.yml -e</code></pre>
</div>
</div>
</li>
<li>
<p>Run the same 2 searches that we ran above and check the structure of the documents for openvas and nessus reports.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2b_transform_and_load_data_part_2">LAB 2B: TRANSFORM AND LOAD DATA - PART 2</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objective_3">OBJECTIVE</h3>
<div class="paragraph">
<p>Explore data transformation and loading options using filebeat and logstash.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instructions_3">INSTRUCTIONS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure Logstash to take filebeat input and index to a test index</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open up a new shell tab and change directory to /home/ubuntu/vrm/lsconfig. Create a blank file named ls2es.conf and configure the input section to accept beats data.</p>
</li>
<li>
<p>Configure the output sections to be sent to a test index in elasticsearch named ‘lstest’. The logstash configuration should look like this</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">input {
 beats {
   port =&gt; <span class="integer">5044</span>
 }
}
filter {
 csv {}
}
output {
 elasticsearch {
   hosts =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9200</span><span class="delimiter">"</span></span>]
   index =&gt; <span class="string"><span class="delimiter">"</span><span class="content">lstest</span><span class="delimiter">"</span></span>
 }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Run logstash pointing it to the newly created configuration file with the config.reload.automatic flag. This will ensure that logstash will pickup any changes to this configuration file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">logstash/bin/logstash -f lsconfig/ls2es.conf --config.reload.automatic</code></pre>
</div>
</div>
</li>
<li>
<p>Configure filebeat to tail and ship csv files to logstash</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>To configure beats to ship data to logstash, kill filebeat instance if running and make a copy of fb2ingest.yml to fb2logstash.yml</p>
</li>
<li>
<p>Modify the input section to pick up the csv files instead of json and the output section to ship to logstash instead of elasticsearch.</p>
</li>
<li>
<p>The resulting configuration file should be as follows</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">cp fbconfig/fb2ingest.yml fbconfig/fb2ls.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">filebeat.inputs</span>:
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/nessus/*.csv</span></span>
 <span class="key">fields</span>:
     <span class="key">scanner</span>: <span class="string"><span class="content">nessus</span></span>
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/openvas/*.csv</span></span>
 <span class="key">fields</span>:
     <span class="key">scanner</span>: <span class="string"><span class="content">openvas</span></span>
<span class="key">filebeat.config.modules</span>:
    <span class="key">path</span>: <span class="string"><span class="content">${path.config}/modules.d/*.yml</span></span>
    <span class="key">reload.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">setup.template.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">output.logstash</span>:
    <span class="key">hosts</span>: <span class="string"><span class="content">["localhost:5044"]</span></span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Run filebeat with the new configuration</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">filebeat/filebeat -c fbconfig/fb2ls.yml -e</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Modify filebeat configuration to handle multiline messages</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Check the resulting documents in lstest index</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET lstest/_search?filter_path=hits.hits._source&amp;size=<span class="integer">50</span></code></pre>
</div>
</div>
</li>
<li>
<p>Examine the output. What is wrong with the output? Notice the field names as well. Where are they coming from? Is it perhaps because of misconfiguration at logstash or filebeat end? Here is a hint</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><a href="https://www.elastic.co/guide/en/beats/filebeat/current/multiline-examples.html">filebeat multiline</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>The weird dissection of the lines from csv file is due to the fact that we haven’t told filebeat how to handle multiline messages. We want every line that doesn’t start with an ip address to be considered as the start of a new line. Everything else should be appended to the line before.</p>
</li>
<li>
<p>Kill filebeat if running and modify fb2ls.yml file to handle multiline messages. The resulting configuration file should look like this</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">filebeat.inputs</span>:
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/nessus/*.csv</span></span>
 <span class="key">multiline.pattern</span>: <span class="string"><span class="content">'^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?'</span></span>
 <span class="key">multiline.negate</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">multiline.match</span>: <span class="string"><span class="content">after</span></span>
 <span class="key">fields</span>:
    <span class="key">scanner</span>: <span class="string"><span class="content">nessus</span></span>
- <span class="string"><span class="content">type: log</span></span>
 <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">paths</span>:
    - <span class="string"><span class="content">/home/ubuntu/vrm/fbdata/openvas/*.csv</span></span>
 <span class="key">multiline.pattern</span>: <span class="string"><span class="content">'^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?'</span></span>
 <span class="key">multiline.negate</span>: <span class="string"><span class="content">true</span></span>
 <span class="key">multiline.match</span>: <span class="string"><span class="content">after</span></span>
 <span class="key">fields</span>:
     <span class="key">scanner</span>: <span class="string"><span class="content">openvas</span></span>
<span class="key">filebeat.config.modules</span>:
    <span class="key">path</span>: <span class="string"><span class="content">${path.config}/modules.d/*.yml</span></span>
    <span class="key">reload.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">setup.template.enabled</span>: <span class="string"><span class="content">false</span></span>
<span class="key">output.logstash</span>:
    <span class="key">hosts</span>: <span class="string"><span class="content">["localhost:5044"]</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>You might have also noticed fields with names such as “column1”, column2”, etc., Logstash csv filter plugin can pick up column names from the header row when reading a file input. Since we are using beats to send the lines to logstash, we need to specify the column names manually.</p>
</li>
<li>
<p>Column names are different for nessus and openvas reports and we need to use conditionals to check the scanner field that we set using filebeat to determine which set of column names to apply for the incoming data. You can obtain the column names for each of the report from the json files and easily using the following commands and paste them into the logstash configuration file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">head -n <span class="integer">1</span> fbdata/openvas/dvl.json | jq <span class="string"><span class="delimiter">'</span><span class="content">keys</span><span class="delimiter">'</span></span>
head -n <span class="integer">1</span> fbdata/nessus/dvl.json | jq <span class="string"><span class="delimiter">'</span><span class="content">keys</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Modify the ls2es.conf file with these changes. The modified configuration file should look something like this.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">input {
 beats {
   port =&gt; <span class="integer">5044</span>
 }
}
filter {
 <span class="keyword">if</span> [fields][scanner] == <span class="string"><span class="delimiter">"</span><span class="content">openvas</span><span class="delimiter">"</span></span> {
   csv {
     columns =&gt; [<span class="string"><span class="delimiter">'</span><span class="content">IP</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Hostname</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Port</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Port Protocol</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">CVSS</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Severity</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Solution Type</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">NVT Name</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Summary</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Specific Result</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">NVT OID</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">CVEs</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Task ID</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Task Name</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Timestamp</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Result ID</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Impact</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Solution</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Affected Software/OS</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Vulnerability Insight</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Vulnerability Detection Method</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Product Detection Result</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">BIDs</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">CERTs</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Other References</span><span class="delimiter">'</span></span>]
}
}
 <span class="keyword">if</span> [fields][scanner] == <span class="string"><span class="delimiter">"</span><span class="content">nessus</span><span class="delimiter">"</span></span> {
   csv {
     columns =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">CVE</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">CVSS</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Description</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Host</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Name</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Plugin ID</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Plugin Output</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Port</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Protocol</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Risk</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">See Also</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Solution</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Synopsis</span><span class="delimiter">"</span></span> ]
         }
}
 mutate {
 remove_field =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>]
 }
}
output {
 elasticsearch {
   hosts =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9200</span><span class="delimiter">"</span></span>]
   index =&gt; <span class="string"><span class="delimiter">"</span><span class="content">lstest</span><span class="delimiter">"</span></span>
 }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the index, registry file and run filebeat with the modified configuration file
+[source,js]
DELETE lstest</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE lstest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">rm filebeat/data/registry
filebeat/filebeat -c fbconfig/fb2ls.yml -e</code></pre>
</div>
</div>
</li>
<li>
<p>Check the resulting documents in lstest index</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET lstest/_search</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Ingest again and test</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If everything looks good, delete the lstest index and modify logstash configuration to route documents to a new index named 'scan_results'. Before we run logstash to start indexing documents, we should delete an alias named 'scan_results' that we created in lab1 to ensure that there is no namespace conflict.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE _all/_alias/scan_results</code></pre>
</div>
</div>
</li>
<li>
<p>Delete filebeat registry and re-run filebeat</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">rm filebeat/data/registry
filebeat/filebeat -c fbconfig/fb2ls.yml -e</code></pre>
</div>
</div>
</li>
<li>
<p>Test the resulting documents in the the scan_results index and ensure mappings and settings for the template we defined in lab 1 were applied.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET scan_results/_search</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2c_transform_and_load_data_part_3">LAB 2C: TRANSFORM AND LOAD DATA - PART 3</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objective_4">OBJECTIVE</h3>
<div class="paragraph">
<p>Modify logstash configuration file created in the previous lab to add enrichment data to the scan data and reingest into elasticsearch.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instructions_4">INSTRUCTIONS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete scan_results index, explore assets index</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the scan_results index because we are going to reingest the same data while enriching it with some asset information.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE scan_results</code></pre>
</div>
</div>
</li>
<li>
<p>Run a match_all query on the assets index and explore the response. What are some of the fields that can be brought in to enrich scan results?</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">GET assets/_search</code></pre>
</div>
</div>
</li>
<li>
<p>Kill logstash if it’s already running. Modify the logstash configuration file that we used in the previous lab to query this index with the ip address in the scan records and enrich every scan record with values in the asset record. The resulting logstash configuration file should look something like this.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">input {
 beats {
   port =&gt; <span class="integer">5044</span>
 }
}
filter {
 <span class="keyword">if</span> [fields][scanner] == <span class="string"><span class="delimiter">"</span><span class="content">openvas</span><span class="delimiter">"</span></span> {
   csv {
     columns =&gt; [<span class="string"><span class="delimiter">'</span><span class="content">IP</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Hostname</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Port</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Port Protocol</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">CVSS</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Severity</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Solution Type</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">NVT Name</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Summary</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Specific Result</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">NVT OID</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">CVEs</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Task ID</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Task Name</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Timestamp</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Result ID</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Impact</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Solution</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Affected Software/OS</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Vulnerability Insight</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Vulnerability Detection Method</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Product Detection Result</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">BIDs</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">CERTs</span><span class="delimiter">'</span></span>,
       <span class="string"><span class="delimiter">'</span><span class="content">Other References</span><span class="delimiter">'</span></span>]
}
   mutate {
     convert =&gt; { IP =&gt; string }
}
elasticsearch {
   hosts =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">localhost:9200</span><span class="delimiter">"</span></span>]
   index =&gt; <span class="string"><span class="delimiter">"</span><span class="content">assets</span><span class="delimiter">"</span></span>
   query =&gt; <span class="string"><span class="delimiter">"</span><span class="content">ip:%{[IP]}</span><span class="delimiter">"</span></span>
   fields =&gt;  {<span class="string"><span class="delimiter">"</span><span class="content">application</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">application</span><span class="delimiter">"</span></span>}
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">data_class</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">data_class</span><span class="delimiter">"</span></span>}
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span> }
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">city</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">city</span><span class="delimiter">"</span></span> }
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">department</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">department</span><span class="delimiter">"</span></span>}
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">location</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">location</span><span class="delimiter">"</span></span> }
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">impact_score</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">impact_score</span><span class="delimiter">"</span></span> }
}
}
 <span class="keyword">if</span> [fields][scanner] == <span class="string"><span class="delimiter">"</span><span class="content">nessus</span><span class="delimiter">"</span></span> {
   mutate {
     convert =&gt; { Host =&gt; string }
}
   csv {
     columns =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">CVE</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">CVSS</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Description</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Host</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Name</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Plugin ID</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Plugin Output</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Port</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Protocol</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Risk</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">See Also</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Solution</span><span class="delimiter">"</span></span>,
         <span class="string"><span class="delimiter">"</span><span class="content">Synopsis</span><span class="delimiter">"</span></span> ]
         }
elasticsearch {
   hosts =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">localhost:9200</span><span class="delimiter">"</span></span>]
   index =&gt; <span class="string"><span class="delimiter">"</span><span class="content">assets</span><span class="delimiter">"</span></span>
   query =&gt; <span class="string"><span class="delimiter">"</span><span class="content">ip:%{[Host]}</span><span class="delimiter">"</span></span>
   fields =&gt;  {<span class="string"><span class="delimiter">"</span><span class="content">application</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">application</span><span class="delimiter">"</span></span>}
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">data_class</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">data_class</span><span class="delimiter">"</span></span>}
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span> }
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">city</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">city</span><span class="delimiter">"</span></span> }
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">department</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">department</span><span class="delimiter">"</span></span>}
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">location</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">location</span><span class="delimiter">"</span></span> }
   fields =&gt;  { <span class="string"><span class="delimiter">"</span><span class="content">impact_score</span><span class="delimiter">"</span></span> =&gt; <span class="string"><span class="delimiter">"</span><span class="content">impact_score</span><span class="delimiter">"</span></span> }
   }
 }
 mutate {
 remove_field =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>]
 }
}
output {
 elasticsearch {
   hosts =&gt; [<span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9200</span><span class="delimiter">"</span></span>]
   index =&gt; <span class="string"><span class="delimiter">"</span><span class="content">scan_results</span><span class="delimiter">"</span></span>
 }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Run logstash with the modified configuration file. Wait for logstash to be fully up and then delete the filebeat registry file and rerun filebeat.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">DELETE lstest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">rm filebeat/data/registry
filebeat/filebeat -c fbconfig/fb2ls.yml -e</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_3_explore_and_visualize">LAB 3: EXPLORE AND VISUALIZE</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objective_5">OBJECTIVE</h3>
<div class="paragraph">
<p>A simulated set of scan results data has been populated for you into an index named scan_analytics that you can use to perform exploratory data analysis (EDA) and visualize.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instructions_5">INSTRUCTIONS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create scan_analytics Index Pattern</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the Management tab, then Kibana &gt; Index Patterns.</p>
</li>
<li>
<p>Define vulnerability_analytics* index pattern for our simulated VRM dataset and select @timestamp field in the Time Filter field name.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Explore documents and fields</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the side navigation, select Discover.</p>
</li>
<li>
<p>Make sure “vulnerability_analytics*” is selected for the index pattern and the time window in the TIme Picker is set to Last 90 Days and using the Histogram zoom into the time window where the data is present.</p>
</li>
<li>
<p>In the time period drop down box where “Auto” is selected, change it to “Daily”.</p>
</li>
<li>
<p>Data has been simulated to mimic daily scans and the number of vulnerabilities are trending down.</p>
</li>
<li>
<p>Take some time to explore the fields on the fields list that is located on the left hand side.</p>
</li>
<li>
<p>Expand a few documents in the Document Table and explore both the table and json structure of the data</p>
</li>
</ol>
</div>
</li>
<li>
<p>Using EDA answer the following questions</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>How many results in the oldest and the most recent scans</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Since the bars in the Histogram represents daily scan results, we can easily move to the oldest scan results by simply clicking on the first bar.</p>
</li>
<li>
<p>What’s the number of hits on the top left corner?</p>
</li>
<li>
<p>Using the Time Picker &gt; Recent Tab, go back the previous time window that displayed the whole dataset and repeat the first two steps to find out the number of hits for the most recent scan. It should be a lot less indicating that the security team is making good progress.</p>
</li>
</ol>
</div>
</li>
<li>
<p>How many of those documents have “injection” in the summary field?</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Use the Query Bar, run a query using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/query-dsl-query-string-query.html#query-string-syntax">Lucene Query Syntax</a> that searches for “injection”</p>
</li>
</ol>
</div>
</li>
<li>
<p>How many of those belong to an asset with Top Secret data_class?</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Create a <a href="https://www.elastic.co/guide/en/kibana/current/field-filter.html#field-filter">filter</a> from the data_class field for only assets containing Top Secret data.</p>
</li>
</ol>
</div>
</li>
<li>
<p>How many of them are low hanging fruits? (low fix effort)?</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>We have a made up field called fix_effort that indicates how easy it is to fix a vulnerability, can you help filter for the low hanging fruits?</p>
</li>
</ol>
</div>
</li>
<li>
<p>How many documents have “cross-site scripting” in the summary field?</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Clear all filters and queries. Using the Query Bar, run a phrase search for “cross-site scripting”</p>
</li>
</ol>
</div>
</li>
<li>
<p>How many of those have a “Critical” severity?</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Use the “Add a Filter+” link in the top left just below the Query Bar and create a filter for Critical severity.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create the following visualizations</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the scan that was run on 1st october 2018, create a Pie Chart of count by Severity (3) and then by Department (3)</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Filter out None for Severity</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a scripted field to calculate risk = impact_score x CVSS</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the left navigation panel, click Management, go to Index Patterns and select the index pattern we created previously for “vulnerability_analytics*”.</p>
</li>
<li>
<p>You should find three tabs, one of which should be the “Scripted Fields” tab.</p>
</li>
<li>
<p>Click on “Scripted Fields” tab and click on “Add scripted field”. Provide the following values in the resulting form</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Name: risk</p>
</li>
<li>
<p>Language: painless</p>
</li>
<li>
<p>Type: number</p>
</li>
<li>
<p>Format: number</p>
</li>
<li>
<p>Script: doc[‘impact_score’].value * doc[‘cvss’].value (Don’t copy paste)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save by clicking on “Create field” and go back to “Discover” and look for the risk field in the fields list.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a Heat Map (as shown below) using this field and the fix_effort to identify vulnerabilities that are easy to fix and are high risk.</p>
<div class="imageblock">
<div class="content">
<img src="http://ec2-35-157-62-29.eu-central-1.compute.amazonaws.com/resources/heatmap.png" alt="heatmap">
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>This should be an interesting challenge to complete without viewing the solution. We encourage trying to complete this as a challenge. Here are some helpful links</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Heat Map</p>
</li>
<li>
<p>Histogram</p>
</li>
<li>
<p>Ordering Buckets</p>
</li>
</ol>
</div>
</li>
<li>
<p>Here is the configuration (answer) if you need it</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">Metrics:
  Aggregation: Count
Buckets:
  - X-Axis:
    - Aggregation: Histogram
    - Field: risk
    - Minimum Interval: <span class="integer">5</span>
  - Y-Axis:
    - Aggregation: Histogram
    - Field: fix_effort
    - Minimum Interval: <span class="integer">1</span>
    - Json Input: { <span class="key"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>: { <span class="key"><span class="delimiter">"</span><span class="content">_key</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">desc</span><span class="delimiter">"</span></span> }}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<hr>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>

</body></html>